# 3.2 Handoff: AudioDecoder Constructor

## Status: COMPLETE

## Note

This task overlaps with TODO-3.1 (AudioDecoder Internal Slots). The 14-step constructor algorithm was fully verified and tested as part of TODO-3.1.

## Spec Compliance Mapping

The 14-step constructor algorithm from spec section 3.2:

| Step | Requirement | Verified In |
|------|-------------|-------------|
| 1 | Create new AudioDecoder object | audio-decoder-slots.test.ts |
| 2 | Assign new queue to [[control message queue]] | audio-decoder-slots.test.ts (reset behavior) |
| 3 | Assign false to [[message queue blocked]] | ControlMessageQueue initialization |
| 4 | Assign null to [[codec implementation]] | State starts unconfigured |
| 5 | Start new parallel queue | Native AsyncWorker |
| 6 | Assign false to [[codec saturated]] | Native initialization |
| 7 | Assign init.output to [[output callback]] | audio-decoder-slots.test.ts |
| 8 | Assign init.error to [[error callback]] | audio-decoder-slots.test.ts |
| 9 | Assign true to [[key chunk required]] | audio-decoder-slots.test.ts |
| 10 | Assign "unconfigured" to [[state]] | audio-decoder-slots.test.ts |
| 11 | Assign 0 to [[decodeQueueSize]] | audio-decoder-slots.test.ts |
| 12 | Assign new list to [[pending flush promises]] | Native flush handling |
| 13 | Assign false to [[dequeue event scheduled]] | CodecBase handling |
| 14 | Return decoder | Constructor returns this |

## Test Coverage (from TODO-3.1)

| Test | Verifies |
|------|----------|
| should initialize state to "unconfigured" | Step 10 |
| should initialize decodeQueueSize to 0 | Step 11 |
| should store output callback | Step 7 |
| should store error callback and invoke it | Step 8 |
| should require key chunk after construction | Step 9 |
| should throw TypeError when output missing | Callback validation |
| should throw TypeError when error missing | Callback validation |
| should throw TypeError when output not function | Callback validation |
| should throw TypeError when error not function | Callback validation |
| should maintain independent state | Multiple instances |

## Files Modified

No additional modifications needed - all work completed in TODO-3.1:
- `lib/audio-decoder.ts`: Added callback validation
- `test/unit/audio-decoder-slots.test.ts`: Added 13 tests

## Downstream Unblocked

- TODO-3.5: Methods use constructor-initialized state
