# 3.3 Handoff: AudioDecoder Attributes

## Status: COMPLETE

## Spec Compliance Mapping

| Spec Section | Requirement | File:Line | Test |
|--------------|-------------|-----------|------|
| 3.3 | state returns [[state]] | audio-decoder.ts:56-58 | state attribute tests |
| 3.3 | decodeQueueSize returns [[decodeQueueSize]] | audio-decoder.ts:60-62 | decodeQueueSize tests |
| 3.3 | ondequeue is EventHandler | codec-base.ts:16-22 | ondequeue tests |
| - | EventTarget inheritance | codec-base.ts:13 | EventTarget tests |

## Test Coverage

| Category | Count | All Pass? |
|----------|-------|-----------|
| state attribute (readonly) | 5 | YES |
| decodeQueueSize attribute (readonly) | 4 | YES |
| ondequeue event handler | 6 | YES |
| EventTarget inheritance | 2 | YES |
| **Total** | **17** | **YES** |

## Tests Added

`test/unit/audio-decoder-attributes.test.ts`:

**state attribute:**
- should be "unconfigured" after construction
- should be "configured" after configure()
- should be "closed" after close()
- should be readonly (no setter)
- should reflect state changes through transitions

**decodeQueueSize attribute:**
- should be 0 after construction
- should be readonly (no setter)
- should increase on decode() (encode/decode roundtrip test)
- should be 0 after reset()

**ondequeue event handler:**
- should be null by default
- should be settable to a function
- should be settable to null
- should fire when decodeQueueSize decreases
- should work with addEventListener
- should not throw if ondequeue is not set

**EventTarget inheritance:**
- should extend EventTarget
- should support removeEventListener

## Implementation Notes

The implementation was already complete:

1. **state**: Getter in `audio-decoder.ts` delegating to `this._native.state`
2. **decodeQueueSize**: Getter returning `this._decodeQueueSize` (tracked locally)
3. **ondequeue**: Getter/setter in `codec-base.ts` with `_triggerDequeue()` method
4. **EventTarget**: `CodecBase` extends `EventTarget`, providing `addEventListener`/`removeEventListener`

No code changes were needed - this task verified existing implementation.

## Files Modified

- `test/unit/audio-decoder-attributes.test.ts`: New test file with 17 tests

## Downstream Unblocked

- TODO-3.5: Methods that modify attributes (decode, flush, reset, close)
