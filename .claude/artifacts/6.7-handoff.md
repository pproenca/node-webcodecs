# 6.7 Handoff: EncodedVideoChunkMetadata

## Status: COMPLETE

## Spec Compliance Mapping

| Spec Section | Field | Type | Implementation | Test |
|--------------|-------|------|----------------|------|
| 6.7 | decoderConfig | VideoDecoderConfig | Native layer provides | decoderConfig tests (4) |
| 6.7 | svc | SvcOutputMetadata | When scalabilityMode used | SVC tests (2) |
| 6.7 | alphaSideData | BufferSource | When alpha: 'keep' | Type test |
| 6.7 | temporalLayerId | unsigned long | In svc metadata | Type test |

## Test Coverage

| Category | Count | All Pass? |
|----------|-------|-----------|
| EncodedVideoChunkMetadata type | 4 | YES |
| SvcOutputMetadata type | 2 | YES |
| output callback signature | 1 | YES |
| decoderConfig metadata | 4 | YES |
| SVC metadata | 2 | YES |
| multiple outputs metadata | 1 | YES |
| edge cases | 1 | YES |
| **Total** | **15** | **YES** |

## Tests Added

`test/unit/video-encoder-metadata.test.ts`:

**EncodedVideoChunkMetadata type:**
- should be exported from library
- should have optional decoderConfig field
- should have optional svc field
- should have optional alphaSideData field

**SvcOutputMetadata type:**
- should be exported from library
- should require temporalLayerId field

**output callback signature:**
- should accept second metadata parameter

**decoderConfig metadata:**
- should have decoderConfig on key frame output
- should have decoderConfig.codec matching encoder config
- should have decoderConfig with codedWidth and codedHeight
- should have decoderConfig for H.264 (description optional)

**SVC metadata:**
- should configure with L1T1 scalabilityMode
- should produce outputs with L1T2 scalabilityMode

**multiple outputs metadata:**
- should provide metadata for multiple outputs

**edge cases:**
- should handle VP9 codec

## Implementation Notes

EncodedVideoChunkMetadata is correctly implemented:
- decoderConfig provided on key frames with codec, codedWidth, codedHeight
- svc metadata available when scalabilityMode configured
- alphaSideData type defined (requires alpha: 'keep' config to use)

Note: description field (SPS/PPS for H.264) is not currently provided by native layer.

## Files Modified

- `test/unit/video-encoder-metadata.test.ts`: New test file with 15 tests

## Downstream Unblocked

- None (metadata is output, no dependencies)
