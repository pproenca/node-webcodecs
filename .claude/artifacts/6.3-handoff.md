# 6.3 Handoff: VideoEncoder Attributes

## Status: COMPLETE

## Spec Compliance Mapping

| Spec Section | Attribute | Type | Implementation | Test |
|--------------|-----------|------|----------------|------|
| 6.3 | state | CodecState (readonly) | lib/video-encoder.ts:78-80 | state attribute tests (4) |
| 6.3 | encodeQueueSize | unsigned long (readonly) | lib/video-encoder.ts:82-84 | encodeQueueSize tests (5) |
| 6.3 | ondequeue | EventHandler | lib/codec-base.ts:16-22 | ondequeue tests (6) |

## Test Coverage

| Category | Count | All Pass? |
|----------|-------|-----------|
| state attribute (readonly) | 4 | YES |
| encodeQueueSize attribute (readonly) | 5 | YES |
| ondequeue attribute (EventHandler) | 6 | YES |
| EventTarget integration | 3 | YES |
| Rapid encodes edge case | 1 | YES |
| **Total** | **19** | **YES** |

## Tests Added

`test/unit/video-encoder-attributes.test.ts`:

**state attribute (readonly):**
- should be "unconfigured" after construction
- should be "configured" after configure()
- should be "closed" after close()
- should be "unconfigured" after reset()

**encodeQueueSize attribute (readonly):**
- should be 0 after construction
- should increase on encode()
- should increase with multiple encodes
- should decrease on output
- should be 0 after reset()

**ondequeue attribute (EventHandler):**
- should be null by default
- should be settable to a function
- should be settable to null
- should fire after output
- should invoke ondequeue handler
- should handle no handler set gracefully

**EventTarget integration:**
- should dispatch to addEventListener
- should support multiple listeners
- should support once option

**Edge cases:**
- should handle rapid encodes without losing track

## Implementation Notes

The implementation is complete in:
- `lib/video-encoder.ts` - state and encodeQueueSize getters
- `lib/codec-base.ts` - ondequeue getter/setter and _triggerDequeue()

Note: The ondequeue handler is invoked without an Event parameter (for backwards
compatibility), while addEventListener handlers do receive Event objects. The W3C
spec defines ondequeue as an EventHandler which should receive Event per HTML spec.

## Files Modified

- `test/unit/video-encoder-attributes.test.ts`: New test file with 19 tests

## Downstream Unblocked

- TODO-6.5: Methods
