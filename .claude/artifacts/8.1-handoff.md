# 8.1 Handoff: EncodedAudioChunk Interface

## Status: COMPLETE

## Spec Compliance Mapping

| Spec Section | Requirement | Implementation | Test |
|--------------|-------------|----------------|------|
| 8.1.1 | Internal slots: type, timestamp, duration, data | Private _native holds state | attribute tests |
| 8.1.2 | Constructor with EncodedAudioChunkInit | lib/encoded-chunks.ts:147-177 | constructor tests (8) |
| 8.1.3 | type attribute ("key"\|"delta") | getter returns _native.type | type tests |
| 8.1.3 | timestamp attribute (microseconds) | getter returns _native.timestamp | timestamp tests |
| 8.1.3 | duration attribute (nullable) | getter returns _native.duration ?? null | duration tests |
| 8.1.3 | byteLength attribute | getter returns _native.byteLength | byteLength test |
| 8.1.4 | copyTo(destination) method | lib/encoded-chunks.ts:195-206 | copyTo tests (4) |
| 8.1.5 | close() for early release | lib/encoded-chunks.ts:213-216 | close tests (2) |

## Test Coverage

| Category | Count | All Pass? |
|----------|-------|-----------|
| 8.1.2 Constructor | 8 | YES |
| 8.1.3 Attributes | 7 | YES |
| 8.1.4 copyTo Method | 4 | YES |
| Edge cases | 3 | YES |
| Type exports | 3 | YES |
| close() method | 2 | YES |
| **Total** | **27** | **YES** |

## Tests Added

`test/unit/encoded-audio-chunk.test.ts`:

**8.1.2 Constructor:**
- should construct with valid init
- should accept type: "key"
- should accept type: "delta"
- should accept ArrayBuffer as data
- should accept Uint8Array as data
- should accept optional duration
- should throw TypeError for invalid type
- should throw TypeError for missing data

**8.1.3 Attributes:**
- should have readonly type attribute
- should have readonly timestamp attribute in microseconds
- should support negative timestamp
- should have nullable duration attribute
- should have duration when provided
- should allow duration = 0 (implementation-specific)
- should have byteLength matching data size

**8.1.4 copyTo Method:**
- should copy data to ArrayBuffer destination
- should copy data to Uint8Array destination
- should copy data to larger destination
- should throw if destination is too small

**Edge cases:**
- should handle zero-length data
- should handle large data (>1MB)
- should preserve microsecond timestamp precision

**Type exports:**
- should export EncodedAudioChunk class
- should export EncodedAudioChunkType type
- should export EncodedAudioChunkInit type

**close() method:**
- should have close method
- should allow double close without error

## Implementation Notes

EncodedAudioChunk is correctly implemented in lib/encoded-chunks.ts:

- Constructor validates type ("key"|"delta") and data
- Accepts ArrayBuffer or ArrayBufferView for data
- FinalizationRegistry provides automatic cleanup if close() not called
- close() is idempotent (safe to call multiple times)

**Known gap:** duration=0 converts to null due to `?? null` operator. Per W3C spec, 0 should be a valid duration distinct from null.

## Files Modified

- `test/unit/encoded-audio-chunk.test.ts`: New test file with 27 tests

## Downstream Unblocked

- TODO-5.x: AudioEncoder outputs EncodedAudioChunk
- TODO-3.x: AudioDecoder inputs EncodedAudioChunk
