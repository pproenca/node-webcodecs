# 7.4 Handoff: Codec String Validation

## Status: COMPLETE

## Spec Compliance Mapping

| Spec Section | Requirement | Implementation | Test |
|--------------|-------------|----------------|------|
| 7.4 rule 1 | Valid per codec specification | Native layer validates | avc1.* tests (5) |
| 7.4 rule 2 | Describes single codec | Native layer validates | all codec tests |
| 7.4 rule 3 | Unambiguous profile/level | Native layer parses | profile tests |

## Test Coverage

| Category | Count | All Pass? |
|----------|-------|-----------|
| H.264/AVC (avc1.*) | 5 | YES |
| H.265/HEVC (hvc1.*, hev1.*) | 2 | YES |
| VP9 (vp09.*) | 3 | YES |
| AV1 (av01.*) | 2 | YES |
| AAC (mp4a.*) | 3 | YES |
| Opus | 1 | YES |
| MP3 | 1 | YES |
| FLAC | 1 | YES |
| Vorbis | 1 | YES |
| Invalid codec strings | 5 | YES |
| Decoder codec strings | 3 | YES |
| Edge cases | 3 | YES |
| **Total** | **30** | **YES** |

## Tests Added

`test/unit/codec-string.test.ts`:

**H.264/AVC (avc1.*):**
- should accept avc1.42001E (Baseline Level 3.0)
- should accept avc1.4D001E (Main Level 3.0)
- should accept avc1.64001E (High Level 3.0)
- should accept avc1.42001F (Baseline Level 3.1)
- should accept lowercase avc1.42001e

**H.265/HEVC (hvc1.*, hev1.*):**
- should handle hvc1 codec string
- should handle hev1 codec string

**VP9 (vp09.*):**
- should accept vp09.00.10.08
- should accept vp09.02.10.10
- should accept simple vp9 string

**AV1 (av01.*):**
- should handle av01.0.04M.08
- should handle simple av1 string

**AAC (mp4a.*):**
- should accept mp4a.40.2 (AAC-LC)
- should accept mp4a.40.5 (HE-AAC)
- should accept simple aac string

**Opus:**
- should accept opus

**MP3:**
- should accept mp3

**FLAC:**
- should handle flac

**Vorbis:**
- should handle vorbis

**Invalid codec strings:**
- should reject empty string
- should reject "invalid" codec
- should reject numeric only codec
- should reject unknown-codec-name
- should reject completely random string

**Decoder codec strings:**
- should accept avc1.42001E for VideoDecoder
- should accept mp4a.40.2 for AudioDecoder
- should accept opus for AudioDecoder

**Edge cases:**
- should handle avc1 without full profile/level
- should handle h264 alias
- should handle whitespace-only codec string

## Implementation Notes

Codec string validation is handled by native layer:
- H.264: avc1.* and h264 alias supported
- H.265: hvc1.* and hev1.* supported (platform-dependent)
- VP9: vp09.* and vp9 alias supported
- AV1: av01.* and av1 alias supported
- AAC: mp4a.40.* and aac alias supported
- Opus: opus supported
- MP3: mp3 supported
- FLAC/Vorbis: platform-dependent support

Invalid codec strings correctly return { supported: false }.

## Files Modified

- `test/unit/codec-string.test.ts`: New test file with 30 tests

## Downstream Unblocked

- TODO-7.5-7.8: Config types can use codec strings
