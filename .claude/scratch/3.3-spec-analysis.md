# Spec Analysis: 3.3

## Algorithms to Implement

### state attribute
**Spec Section:** 3.3
**Behavior:**
- Returns the value of [[state]] internal slot
- Read-only attribute
- Type: CodecState ('unconfigured' | 'configured' | 'closed')

**Already Implemented:** lib/audio-decoder.ts:56-58
```typescript
get state(): CodecState {
  return this._native.state;
}
```

### decodeQueueSize attribute
**Spec Section:** 3.3
**Behavior:**
- Returns the value of [[decodeQueueSize]] internal slot
- Read-only attribute
- Type: unsigned long (number)

**Already Implemented:** lib/audio-decoder.ts:60-62
```typescript
get decodeQueueSize(): number {
  return this._decodeQueueSize;
}
```

### ondequeue event handler
**Spec Section:** 3.3
**Behavior:**
- Event handler IDL attribute
- Event type: 'dequeue'
- Fires when decodeQueueSize decreases

**Already Implemented:** lib/codec-base.ts:16-22, 28-40
- getter/setter for ondequeue
- _triggerDequeue() dispatches Event and calls callback

## Tests Required

### State Attribute Tests
1. state is "unconfigured" after construction - ALREADY TESTED (audio-decoder-slots.test.ts:29)
2. state is "configured" after configure() - ALREADY TESTED (golden/audio-decoder.test.ts:138)
3. state is "closed" after close() - NEEDS TEST
4. state is readonly (no setter) - NEEDS TEST

### decodeQueueSize Attribute Tests
5. decodeQueueSize is 0 after construction - ALREADY TESTED (audio-decoder-slots.test.ts:36)
6. decodeQueueSize increases on decode() - NEEDS TEST
7. decodeQueueSize decreases when output received - NEEDS TEST (partial in golden)
8. decodeQueueSize is readonly (no setter) - NEEDS TEST

### ondequeue Event Handler Tests
9. ondequeue can be set to a function - NEEDS TEST
10. ondequeue can be set to null - NEEDS TEST
11. ondequeue callback fires when queue decreases - NEEDS TEST
12. addEventListener('dequeue') also works - NEEDS TEST
13. ondequeue not set causes no error - NEEDS TEST

## Inputs NOT in Test Requirements (Must Still Work)
- ondequeue set to undefined (should behave like null)
- Multiple consecutive decode() calls incrementing queue
- Multiple outputs decreasing queue multiple times

## Gap Analysis

Many tests already exist in audio-decoder-slots.test.ts and golden tests.
Need to add:
- Explicit readonly tests for state and decodeQueueSize
- Comprehensive ondequeue/dequeue event tests
- State transition to 'closed'
