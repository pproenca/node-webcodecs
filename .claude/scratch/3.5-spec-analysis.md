# Spec Analysis: 3.5

## Methods to Test

### configure(config) - Spec 3.5
**Algorithm Steps:**
1. If config is not valid, throw TypeError
2. If [[state]] is "closed", throw InvalidStateError
3. Set [[state]] to "configured"
4. Set [[key chunk required]] to true
5. Queue control message to configure

**Tests Needed:**
- configure() with valid config succeeds - COVERED (golden, contracts)
- configure() with missing codec throws TypeError - COVERED (golden)
- configure() with missing sampleRate throws TypeError - COVERED (golden)
- configure() with missing numberOfChannels throws TypeError - COVERED (golden)
- configure() when closed throws InvalidStateError - COVERED (golden)
- configure() sets state to "configured" - COVERED (golden, contracts)

### decode(chunk) - Spec 3.5
**Algorithm Steps:**
1. If [[state]] is not "configured", throw InvalidStateError
2. If [[key chunk required]] is true and chunk type is not "key", throw DataError
3. Increment [[decodeQueueSize]]
4. Queue control message to decode

**Tests Needed:**
- decode() when unconfigured throws InvalidStateError - COVERED (golden)
- decode() when closed throws InvalidStateError - COVERED (golden)
- decode() with delta chunk first throws DataError - COVERED (audio-decoder-slots.test.ts)
- decode() increments decodeQueueSize - NEEDS TEST

### flush() - Spec 3.5
**Algorithm Steps:**
1. If [[state]] is not "configured", reject with InvalidStateError
2. Set [[key chunk required]] to true
3. Return Promise that resolves after outputs

**Tests Needed:**
- flush() when configured resolves - COVERED (golden)
- flush() when unconfigured rejects InvalidStateError - NEEDS TEST
- flush() when closed rejects InvalidStateError - NEEDS TEST
- flush() with no pending work resolves immediately - NEEDS TEST

### reset() - Spec 3.5
**Algorithm:**
- Run Reset AudioDecoder with AbortError
- Clear queue, reset to unconfigured

**Tests Needed:**
- reset() clears queue - COVERED (audio-decoder-slots.test.ts)
- reset() resets to unconfigured - COVERED (golden, contracts)
- reset() when closed is no-op - COVERED (golden)

### close() - Spec 3.5
**Algorithm:**
- Run Close AudioDecoder with AbortError
- Final state

**Tests Needed:**
- close() transitions to closed - COVERED (contracts)
- close() from unconfigured - COVERED (contracts)
- close() from configured - COVERED (contracts)

### isConfigSupported(config) - Spec 3.5
**Algorithm Steps:**
1. If config is not valid, reject with TypeError
2. Return Promise with {supported, config}

**Tests Needed:**
- isConfigSupported() returns supported: true for valid codec - COVERED (golden)
- isConfigSupported() returns supported: false for invalid codec - NEEDS TEST
- isConfigSupported() rejects with TypeError for invalid config - NEEDS TEST

## Gap Analysis

Missing tests:
1. decode() increments decodeQueueSize (verifiable)
2. flush() when unconfigured rejects InvalidStateError
3. flush() when closed rejects InvalidStateError
4. flush() with no pending work resolves immediately
5. isConfigSupported() returns supported: false for unknown codec
6. isConfigSupported() rejects with TypeError for invalid config
