# Spec Analysis: 4.1

## Internal Slots to Verify

### [[control message queue]]
- Implementation: `_controlQueue: ControlMessageQueue` (video-decoder.ts:25)
- Verified via reset behavior

### [[message queue blocked]]
- Implementation: In ControlMessageQueue.processing
- Internal behavior

### [[codec implementation]]
- Implementation: `_native: NativeVideoDecoder` (video-decoder.ts:24)
- Verified via state management

### [[codec work queue]]
- Implementation: AsyncDecodeWorker (native layer)
- Internal behavior

### [[codec saturated]]
- Implementation: `native.codecSaturated` (video-decoder.ts:75-77)
- Exposed as property

### [[output callback]]
- Implementation: `init.output` (video-decoder.ts:46-59)
- Verified via output invocation

### [[error callback]]
- Implementation: `_errorCallback` (video-decoder.ts:28)
- Verified via error invocation

### [[key chunk required]]
- Implementation: `_needsKeyFrame: boolean = true` (video-decoder.ts:27)
- Verified via delta chunk rejection

### [[state]]
- Implementation: `native.state` (video-decoder.ts:67-69)
- Verified via state tests

### [[decodeQueueSize]]
- Implementation: `_decodeQueueSize: number = 0` (video-decoder.ts:26)
- Verified via queue tests

### [[pending flush promises]]
- Implementation: In native flush()
- Verified via flush tests

### [[dequeue event scheduled]]
- Implementation: In CodecBase._triggerDequeue
- Verified via dequeue tests

## Tests Required

Most tests already exist in golden tests. Need to add:
1. State initialization to "unconfigured" - COVERED
2. decodeQueueSize initialization to 0 - COVERED
3. Output callback receives VideoFrame - NEEDS TEST
4. Error callback validation - NEEDS TEST (callback validation added)
5. Key chunk required after construction - NEEDS TEST
6. Multiple instances independent - NEEDS TEST
