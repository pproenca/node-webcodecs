# Spec Analysis: 3.4

## Events to Implement

### dequeue event
**Spec Section:** 3.4
**Event Interface:** Event
**Fires when:** decodeQueueSize decreases

**Already Implemented:**
- codec-base.ts:28-40 `_triggerDequeue()` dispatches Event and calls ondequeue callback
- audio-decoder.ts:46-47 calls `_triggerDequeue()` after output

## Tests Required

### Unit Tests (from task packet)
1. dequeue event fires after decode output - COVERED (audio-decoder-attributes.test.ts)
2. dequeue event fires after flush completes - NEEDS TEST
3. ondequeue handler called with Event object - NEEDS TEST (current tests don't verify Event arg)
4. addEventListener("dequeue", ...) works - COVERED (audio-decoder-attributes.test.ts)
5. Events coalesced for rapid outputs - NEEDS TEST

### Edge Cases (from task packet)
6. No handler set (no error) - COVERED (audio-decoder-attributes.test.ts)
7. Handler throws (should not break decoder) - NEEDS TEST
8. Handler removed mid-operation - NEEDS TEST

### Error Cases (from task packet)
9. Dispatching event after close (should not fire) - NEEDS TEST

## Gap Analysis

Most tests exist in audio-decoder-attributes.test.ts.
Need to add:
- Event object verification (event.type === 'dequeue')
- Handler throws test
- Event coalescing test
- After close test
